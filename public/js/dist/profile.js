import{ordersCard as a}from"./ordersCard.js";document.addEventListener("DOMContentLoaded",function(){const t=new URLSearchParams(window.location.search).get("section");s(t==="orders"?"orders":t==="wishlist"?"wishlist":"profile")}),document.querySelector(".logout-btn").addEventListener("click",function(){fetch("/logout",{method:"POST"}).then(t=>{t.ok?window.location.href="/":(console.log("\u041E\u0448\u0438\u0431\u043A\u0430:",t.statusText),alert("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0432\u044B\u0445\u043E\u0434\u0435: "+t.statusText))}).catch(t=>console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",t))}),document.getElementById("orders").addEventListener("click",function(t){console.log("orders"),s("orders")}),document.getElementById("wishlist").addEventListener("click",function(t){s("wishlist")}),document.getElementById("settings").addEventListener("click",function(t){s("profile")}),document.getElementById("logout").addEventListener("click",function(t){s("logout1")}),document.getElementById("support").addEventListener("click",function(t){s("support")});function s(t){if(console.log("sectionId:",t),document.querySelectorAll(".content-section").forEach(e=>{e.style.display="none"}),t==="orders")console.log("sectionId:",t),fetch("/orders").then(e=>{if(!e.ok)throw new Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u0435\u0442\u0438: "+e.statusText);return e.json()}).then(e=>{console.log(e);const n=document.getElementById("orders-section"),r=document.getElementById("orders-content");r.innerHTML="",e.orders.length>0?(console.log("data.orders:",e.orders),e.orders.forEach(l=>{const c=e.books.find(i=>i.id===l.book_id);r.innerHTML+=a(c,t)}),document.querySelectorAll(".delete-btn-orders").forEach(l=>{l.addEventListener("click",function(c){const i=c.target.dataset.id;fetch("/orders/remove-from-orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bookId:i})}).then(o=>{if(!o.ok)throw new Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u0435\u0442\u0438: "+o.statusText);return o.json()}).then(o=>{o.success?s("orders"):alert("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0443\u0434\u0430\u043B\u0438\u0442\u044C \u043A\u043D\u0438\u0433\u0443 \u0438\u0437 \u0441\u043F\u0438\u0441\u043A\u0430 \u0436\u0435\u043B\u0430\u0435\u043C\u043E\u0433\u043E")}).catch(o=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",o),alert("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0443\u0434\u0430\u043B\u0438\u0442\u044C \u043A\u043D\u0438\u0433\u0443 \u0438\u0437 \u0441\u043F\u0438\u0441\u043A\u0430 \u0436\u0435\u043B\u0430\u0435\u043C\u043E\u0433\u043E: "+o.message)})})})):r.innerHTML="<p>\u0423 \u0432\u0430\u0441 \u043D\u0435\u0442 \u043A\u043D\u0438\u0433 \u0432 \u043A\u043E\u0440\u0437\u0438\u043D\u0435</p>",n.style.display="block"}).catch(e=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",e),alert("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0437\u0430\u043A\u0430\u0437\u044B: "+e.message)});else if(t==="wishlist")fetch("/wishlist").then(e=>{if(!e.ok)throw new Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u0435\u0442\u0438: "+e.statusText);return e.json()}).then(e=>{const n=document.getElementById("wishlist-section"),r=document.getElementById("wishlist-content");r.innerHTML="",e.wishlist.length>0?(e.wishlist.forEach(l=>{const c=e.books.find(i=>i.id===l.book_id);r.innerHTML+=a(c,t)}),document.querySelectorAll(".delete-btn-wishlist").forEach(l=>{l.addEventListener("click",function(c){const i=c.target.dataset.id;fetch("/wishlist/remove-from-wishlist",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bookId:i})}).then(o=>{if(!o.ok)throw new Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u0435\u0442\u0438: "+o.statusText);return o.json()}).then(o=>{o.success?s("wishlist"):alert("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0443\u0434\u0430\u043B\u0438\u0442\u044C \u043A\u043D\u0438\u0433\u0443 \u0438\u0437 \u0441\u043F\u0438\u0441\u043A\u0430 \u0436\u0435\u043B\u0430\u0435\u043C\u043E\u0433\u043E")}).catch(o=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",o),alert("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0443\u0434\u0430\u043B\u0438\u0442\u044C \u043A\u043D\u0438\u0433\u0443 \u0438\u0437 \u0441\u043F\u0438\u0441\u043A\u0430 \u0436\u0435\u043B\u0430\u0435\u043C\u043E\u0433\u043E: "+o.message)})})})):r.innerHTML="<p>\u0423 \u0432\u0430\u0441 \u043D\u0435\u0442 \u043A\u043D\u0438\u0433 \u0432 \u0441\u043F\u0438\u0441\u043A\u0435 \u0436\u0435\u043B\u0430\u0435\u043C\u043E\u0433\u043E</p>",n.style.display="block"}).catch(e=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",e),alert("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0441\u043F\u0438\u0441\u043E\u043A \u0436\u0435\u043B\u0430\u0435\u043C\u043E\u0433\u043E: "+e.message)});else if(t==="settings")s("profile");else if(t==="support"){const e=document.getElementById("support-section");e.style.display="block"}else if(t==="logout"){const e=document.getElementById("logout");e.style.display="block"}else{const e=document.getElementById(t);e.style.display="block"}}document.getElementById("avatar-btn").addEventListener("click",function(t){t.preventDefault();const d=document.querySelector('input[type="file"]').files[0],e=new FormData;e.append("avatar",d),fetch("/upload-avatar",{method:"POST",body:e}).then(n=>{if(!n.ok)throw new Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u0435\u0442\u0438: "+n.statusText);return n.json()}).then(n=>{n.success?(document.getElementById("avatar-img").src=n.filePath,alert("\u0410\u0432\u0430\u0442\u0430\u0440 \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D")):alert("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u0430\u0432\u0430\u0442\u0430\u0440")}).catch(n=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",n),alert("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u0430\u0432\u0430\u0442\u0430\u0440: "+n.message)})});
